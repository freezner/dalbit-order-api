<?xml version="1.0" encoding="UTF-8"?>

<!-- 30초마다 설정 파일의 변경을 확인한다. 파일이 변경되면 다시 로딩한다 -->
<configuration scan="true" scanPeriod="30 seconds">

    <!-- setting -->
    <springProfile name="dev">
        <property resource="application-dev.properties"/>
    </springProfile>
    <springProfile name="prod">
        <property resource="application-prod.properties"/>
    </springProfile>

    <!-- log packagename -->
    <property name="LOG_PACKAGE_NAME" value="dalbit-order-api"/>
    <!-- log file path -->
    <property name="LOG_PATH" value="${logging.file.path}"/>
    <!-- log file name -->
    <property name="LOG_FILE_NAME" value="${logging.file.name}"/>
    <!-- log days -->
    <property name="LOG_DAYS" value="10"/>
    <!-- log filesize log -->
    <property name="LOG_FILESIZE_LOG" value="${logging.logback.rollingpolicy.max-file-size}"/>
    <!-- log filesize total -->
    <property name="LOG_TOTAL_FILESIZE" value="${logging.logback.rollingpolicy.total-size-cap}"/>
    <!-- log min count -->
    <property name="LOG_FILE_MIN" value="1"/>
    <!-- log max count -->
    <property name="LOG_FILE_MAX" value="${logging.logback.rollingpolicy.max-history}"/>
    <!-- pattern -->
    <property name="LOG_PATTERN" value="%-5level %d{yy-MM-dd HH:mm:ss} [%logger{0}:%line] - %msg%n"/>
    <property name="LOG_PATTERN_LIVE" value="%-5level %d{yy-MM-dd HH:mm:ss} [%method:%line] - %msg%n"/>

    <!-- console log -->
    <appender name="console" class="ch.qos.logback.core.ConsoleAppender">
        <encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
            <pattern>${LOG_PATTERN}</pattern>
        </encoder>
    </appender>

    <!-- 로그 파일 생성 관련 -->
    <!-- 로그 모드 -->
    <!-- log file -->
    <appender name="file" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${LOG_PATH}/${LOG_FILE_NAME}</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>${LOG_PATH}/${LOG_FILE_NAME}.%d{yyyy-MM-dd}</fileNamePattern>
        </rollingPolicy>
        <encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
            <pattern>${LOG_PATTERN}</pattern>
        </encoder>
    </appender>

    <if condition='property("spring.profiles.active").equals("prod")'>
        <then>
            <logger name="${LOG_PACKAGE_NAME}" level="INFO"/>

            <root level="INFO">
                <appender-ref ref="console"/>
                <appender-ref ref="file"/>
            </root>

            <logger name="org.springframework.web" additivity="false">
                <level value="${logging.level.org.springframework.web}"/>
                <appender-ref ref="console"/>
                <appender-ref ref="file"/>
            </logger>

            <logger name="org.hibernate" additivity="false">
                <level value="${logging.level.org.hibernate}"/>
                <appender-ref ref="console"/>
                <appender-ref ref="file"/>
            </logger>

            <logger name="org.hibernate.SQL" additivity="false">
                <level value="${logging.level.org.hibernate.SQL}"/>
                <appender-ref ref="console"/>
                <appender-ref ref="file"/>
            </logger>
        </then>
        <else>
            <logger name="${LOG_PACKAGE_NAME}" level="INFO"/>

            <root level="INFO">
                <appender-ref ref="console"/>
                <appender-ref ref="file"/>
            </root>

            <logger name="org.springframework.web" additivity="false">
                <level value="${logging.level.org.springframework.web}"/>
                <appender-ref ref="console"/>
                <appender-ref ref="file"/>
            </logger>

            <logger name="org.hibernate" additivity="false">
                <level value="${logging.level.org.hibernate}"/>
                <appender-ref ref="console"/>
                <appender-ref ref="file"/>
            </logger>

            <logger name="org.hibernate.SQL" additivity="false">
                <level value="${logging.level.org.hibernate.SQL}"/>
                <appender-ref ref="console"/>
                <appender-ref ref="file"/>
            </logger>
        </else>
    </if>
</configuration>
